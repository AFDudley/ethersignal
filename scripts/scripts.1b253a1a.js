"use strict";var app=angular.module("nohoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/cliquickstart",{templateUrl:"views/cliquickstart.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope",function(a){a.questions=[{id:"question1",name:"Should we hard fork?"},{id:"question2",name:"Is Ether awesome?"},{id:"question3",name:"Bro, do you even blockchain?"}]}]),app.controller("AboutCtrl",["$scope",function(a){}]);var isMist="undefined"!=typeof web3,obj=obj||"",web3;if("undefined"!=typeof web3&&"undefined"!=typeof Web3)web3=new Web3(web3.currentProvider);else if("undefined"!=typeof Web3&&(web3=new Web3(new Web3.providers.HttpProvider("http://localhost:8545")),!web3.isConnected())){var Web3=require("web3");web3=new Web3(new Web3.providers.HttpProvider("https://signal.ether.ai/proxy"))}var ethersignalContract=web3.eth.contract([{constant:!1,inputs:[{name:"pro",type:"bool"}],name:"setSignal",outputs:[],type:"function"},{constant:!1,inputs:[],name:"endSignal",outputs:[],type:"function"},{inputs:[{name:"rAddr",type:"address"}],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"pro",type:"bool"},{indexed:!1,name:"addr",type:"address"}],name:"LogSignal",type:"event"},{anonymous:!1,inputs:[],name:"EndSignal",type:"event"}]),positionregistryContract=web3.eth.contract([{constant:!1,inputs:[{name:"title",type:"string"},{name:"text",type:"string"}],name:"registerPosition",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"regAddr",type:"address"},{indexed:!0,name:"sigAddr",type:"address"},{indexed:!1,name:"title",type:"string"},{indexed:!1,name:"text",type:"string"}],name:"LogPosition",type:"event"}]),positionregistry=positionregistryContract.at("0x0265a5b822625ca506c474912662617c394bbb66"),to="0x0265a5b822625ca506c474912662617c394bbb66",connected=!1;app.directive("networkStats",["ethereum","$interval","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"new-networkstats.html",link:function(a){b(function(){c.pending||(a.sinceLastBlock<=20?a.syncState="good":a.sinceLastBlock>20&&a.sinceLastBlock<60?a.syncState="warning":a.syncState="bad",a.sinceLastBlock+=1)},1e3)}}}]),app.directive("accountSelector",["ethereum","ethSignalContract","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"new-accountselector.html",link:function(b){b.accounts=a.accounts,b.user={defaultAccount:"coinbase"},b.$watch("user.defaultAccount",function(b,c){c!=b&&(a.web3.eth.defaultAccount=b)}),b.newProposal=function(){c.newProposals=[],$("#submitPositionModal").modal("show"),c.newProposals.push({name:"",description:""})}}}}]),app.directive("proposalsList",["proposalService","ethereum","$uibModal","$rootScope",function(a,b,c,d){return{restrict:"E",templateUrl:"new-proposalslist.html",link:function(c){c.proposals=a.proposals,c.percentage=function(a,b){return a+b},c.cancel=function(){$("#submitPositionModal").modal("hide")},c.vote=function(c,d){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert('Please select an account to from the "Select Account" dropdown.'):void a.vote(c,d)},c.createProposal=function(d){return angular.isUndefined(b.web3.eth.defaultAccount)?void alert("Cannot find an account."):""==d.name?void(c.invalidForm=!0):(c.invalidForm=!1,void a.newProposal(d))}}}}]),app.directive("showErrors",function(){return{restrict:"A",link:function(a,b){b.bind("blur",function(){var a=b.toggleClass("has-error",a)})}}}),app.service("ethereum",["$rootScope","$interval","$timeout",function(a,b,c){function d(a){var b=new Date(0);return b.setUTCSeconds(a),b.toString()}function e(a){return 1==a?"Main-Net":2==a?"Test-Net":void 0}function f(a){return a?"connected":"disconnected"}function g(a){return 1==a?"https://etherscan.io/tx":2==a?"https://testnet.etherscan.io/tx":void 0}function h(){var b=web3.eth.filter("latest");b.watch(function(b,c){web3.eth.getBlock(c,!1,function(b,c){a.pending=!1,a.currentBlock=c.number,a.currentBlockTime=d(c.timestamp),a.sinceLastBlock=-1})})}a.isMist=isMist,a.pending=!0,a.syncState="warning",a.currentBlock="SYNCING",a.currentBlockTime="SYNCING",a.sinceLastBlock=0,b(function(){var b=web3.isConnected();b!=connected&&(a.$emit("connectionStateChanged",b),b&&(a.isMist||h(),web3.eth.defaultAccount=web3.eth.accounts[0],a.ethereumNetwork=e(web3.version.network),a.etherscanUrl=g(web3.version.network)),a.connectionStateDisplay=f(b),a.connectionState=b,connected=b)},1e3);var i=null;return{web3:web3,accounts:i}}]),app.service("ethSignalContract",["ethereum",function(a){var b=a.web3,c=[{constant:!0,inputs:[{name:"",type:"uint256"}],name:"proposals",outputs:[{name:"name",type:"string",value:"Do you support the hard fork?"},{name:"description",type:"string",value:'"Decentralization without decentralized social responsibility is terrifying"\\n-Vlad Zamfir'},{name:"creator",type:"address",value:"0xb2445f120a5a4fe73c4ca9b3a73f415371b5656b"},{name:"active",type:"bool",value:!0}],type:"function"},{constant:!0,inputs:[],name:"numberOfProposals",outputs:[{name:"_numberOfProposals",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"proposalID",type:"uint256"},{name:"position",type:"bool"}],name:"vote",outputs:[],type:"function"},{constant:!1,inputs:[{name:"proposalName",type:"string"},{name:"proposalDescription",type:"string"}],name:"newProposal",outputs:[],type:"function"},{inputs:[],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalID",type:"uint256"},{indexed:!1,name:"position",type:"bool"},{indexed:!1,name:"voter",type:"address"}],name:"userVotedEvent",type:"event"},{anonymous:!1,inputs:[{indexed:!1,name:"proposalName",type:"string"},{indexed:!1,name:"proposalDescription",type:"string"},{indexed:!1,name:"creator",type:"address"}],name:"proposalCreatedEvent",type:"event"}];return b.eth.contract(c).at(to)}]);var allThings={};app.service("proposalService",["ethSignalContract","$q","ethereum","$rootScope",function(a,b,c,d){function e(){positionregistry.LogPosition({},{fromBlock:12e5}).get(function(a,b){a&&console.warn();var c,d;for(c in b)d=web3.fromWei(web3.eth.getBalance(b[c].args.sigAddr)),d>=i&&f(b[c])})}function f(a){var b=a.args.sigAddr;allThings[b]={},allThings[b].raw=a;var c=ethersignalContract.at(b);c.LogSignal({},{fromBlock:12e5}).get(function(c,d){c&&console.warn("warning"),allThings[b].sigList=d;var e,f={},g={};for(e in d)d[e].args.pro?(f[d[e].args.addr]=1,g[d[e].args.addr]=0):(f[d[e].args.addr]=0,g[d[e].args.addr]=1);h(f,g,a)})}function g(a,b){var c=[];return c[0]=Math.round(100*a/(a+b)),c[1]=Math.round(100*b/(a+b)),c}function h(a,b,c){var d=0,e=0;Object.keys(a).map(function(c){var d=web3.fromWei(web3.eth.getBalance(c));a[c]=a[c]*d,b[c]=b[c]*d}),Object.keys(a).map(function(b){d+=parseFloat(a[b])}),Object.keys(b).map(function(a){e+=parseFloat(b[a])});var f=g(d,e);j.push({title:c.args.title,desc:c.args.text,regAddr:c.args.regAddr,pro:Math.round(d),against:Math.round(e),percent:f,sigAddr:c.args.sigAddr})}var i=0,j=[];return d.newProposals=[],d.$on("connectionStateChanged",function(a,b){b&&e()}),{proposals:j,percentage:function(a){},vote:function(a,b){var e=c.web3.eth.defaultAccount,f=ethersignalContract.at(a);try{d.lastTx=f.setSignal(b,{from:e})}catch(a){console.log("Error submitting signal"),console.log(a),alert("Error submitting signal")}},newProposal:function(a){from=c.web3.eth.defaultAccount;var b=positionregistry.registerPosition.getData(a.name,a.description),e=c.web3.eth.estimateGas({from:from,to:to,data:b});try{d.lastTx=positionregistry.registerPosition.sendTransaction(a.name,a.description,{from:from,to:to,gas:e})}catch(a){console.log("Error submitting position"),console.log(a),alert("Error submitting position")}$("#submitPositionModal").modal("hide"),d.newProposals=[]}}}]);