"use strict";var app=angular.module("nohoApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","angular-scroll-animate"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/cliquickstart",{templateUrl:"views/cliquickstart.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),app.controller("MainCtrl",["$scope","$rootScope",function(a,b){a.title="EtherSignal",b.alerts=[],a.closeAlert=function(b){a.alerts.splice(b,1)}}]),app.controller("AboutCtrl",["$scope",function(a){}]);var isMist="undefined"!=typeof web3,obj=obj||"",web3;if("undefined"!=typeof web3&&"undefined"!=typeof Web3)web3=new Web3(web3.currentProvider);else if("undefined"!=typeof Web3&&(web3=new Web3(new Web3.providers.HttpProvider("http://localhost:8545")),!web3.isConnected())){var Web3=require("web3");web3=new Web3(new Web3.providers.HttpProvider("https://signal.ether.ai/proxy"))}var ethersignalContract=web3.eth.contract([{constant:!1,inputs:[{name:"amount",type:"uint256"}],name:"withdraw",outputs:[],type:"function"},{constant:!1,inputs:[{name:"pro",type:"bool"}],name:"setSignal",outputs:[],type:"function"},{constant:!1,inputs:[],name:"endSignal",outputs:[],type:"function"},{inputs:[{name:"rAddr",type:"address"}],type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"pro",type:"bool"},{indexed:!1,name:"addr",type:"address"}],name:"LogSignal",type:"event"},{anonymous:!1,inputs:[],name:"EndSignal",type:"event"}]),positionregistryContract=web3.eth.contract([{constant:!1,inputs:[{name:"title",type:"string"},{name:"text",type:"string"}],name:"registerPosition",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"regAddr",type:"address"},{indexed:!0,name:"sigAddr",type:"address"},{indexed:!1,name:"title",type:"string"},{indexed:!1,name:"text",type:"string"}],name:"LogPosition",type:"event"}]),to="0x9e75993a7a9b9f92a1978bcc15c30cbcb967bc81",positionregistry=positionregistryContract.at(to),connected=!1;app.directive("networkStats",["ethereum","$interval","$rootScope",function(a,b,c){return{restrict:"E",templateUrl:"new-networkstats.html",link:function(a){b(function(){c.pending||(a.sinceLastBlock<=20?a.syncState="good":a.sinceLastBlock>20&&a.sinceLastBlock<60?a.syncState="warning":a.syncState="bad",a.sinceLastBlock+=1)},1e3)}}}]),app.directive("accountSelector",["ethereum","$rootScope",function(a,b){return{restrict:"E",templateUrl:"new-accountselector.html",link:function(c){c.accounts=a.accounts,c.user={defaultAccount:"coinbase"},c.$watch("user.defaultAccount",function(b,c){c!==b&&(a.web3.eth.defaultAccount=b)}),c.newProposal=function(){b.newProposals=[],$("#submitPositionModal").modal("show"),b.newProposals.push({name:"",description:""})}}}}]),app.directive("proposalsList",["proposalService","ethereum","$uibModal","$rootScope",function(a,b,c,d){return{restrict:"E",templateUrl:"new-proposalslist.html",link:function(c){c.proposals=a.proposals,c.percentage=function(a,b){return a+b},c.cancel=function(){$("#submitPositionModal").modal("hide")},c.vote=function(c,e){return angular.isUndefined(b.web3.eth.defaultAccount)?void(d.alerts=[{type:"danger",msg:"Please select an account"}]):void a.vote(c,e)},c.createProposal=function(e){return angular.isUndefined(b.web3.eth.defaultAccount)?void(d.alerts=[{type:"danger",msg:"Cannot find an account."}]):""===e.name?void(c.invalidForm=!0):(c.invalidForm=!1,void a.newProposal(e))}}}}]),app.directive("showErrors",function(){return{restrict:"A",link:function(a,b){b.bind("blur",function(){var a=b.toggleClass("has-error",a)})}}}),app.service("ethereum",["$rootScope","$interval","$timeout",function(a,b,c){function d(a){var b=new Date(0);return b.setUTCSeconds(a),b.toString()}function e(a){return 1===a?"Main-Net":2===a?"Test-Net":void 0}function f(a){return a?"connected":"disconnected"}function g(a){return 1===a?"https://etherscan.io/tx":2===a?"https://testnet.etherscan.io/tx":void 0}function h(){var b=web3.eth.filter("latest");b.watch(function(b,c){web3.eth.getBlock(c,!1,function(b,c){a.pending=!1,a.currentBlock=c.number,a.currentBlockTime=d(c.timestamp),a.sinceLastBlock=-1})})}a.isMist=isMist,a.pending=!0,a.syncState="warning",a.currentBlock="SYNCING",a.currentBlockTime="SYNCING",a.sinceLastBlock=0,a.minDeposit=0,b(function(){var b=web3.isConnected();b!==connected&&(a.$emit("connectionStateChanged",b),b&&(a.isMist||h(),web3.eth.defaultAccount=web3.eth.accounts[0],a.ethereumNetwork=e(web3.version.network),a.etherscanUrl=g(web3.version.network)),a.connectionStateDisplay=f(b),a.connectionState=b,connected=b)},1e3);var i=null;return{web3:web3,accounts:i}}]),app.service("proposalService",["$q","ethereum","$rootScope",function(a,b,c){function d(){for(;h.pop(););positionregistry.LogPosition({},{fromBlock:12e5}).get(function(a,b){a&&console.warn();var d,f;for(d in b){var g=web3.eth.getBlock(b[d].blockNumber);f=Number(web3.fromWei(web3.eth.getBalance(b[d].args.sigAddr),"finney")),f>=c.minDeposit&&e(b[d],f,g)}})}function e(a,b,c){var d=a.args.sigAddr,e=ethersignalContract.at(d);e.LogSignal({},{fromBlock:a.blockNumber}).get(function(d,e){d&&console.warn("warning");var f,h={},i={};for(f in e)e[f].args.pro?(h[e[f].args.addr]=1,i[e[f].args.addr]=0):(h[e[f].args.addr]=0,i[e[f].args.addr]=1);g(h,i,a,b,c)})}function f(a,b){var c=[];return c[0]=Math.round(100*a/(a+b)),c[1]=Math.round(100*b/(a+b)),c}function g(a,b,c,d,e){var g=0,i=0,j=!1,k=!1;Object.keys(a).map(function(c){var d=web3.fromWei(web3.eth.getBalance(c));a[c]=a[c]*d,b[c]=b[c]*d;var e;for(e in web3.eth.accounts)web3.eth.accounts[e]===c&&(k=!0)});var l;for(l in web3.eth.accounts)web3.eth.accounts[l]===c.args.regAddr&&(j=!0);Object.keys(a).map(function(b){g+=parseFloat(a[b])}),Object.keys(b).map(function(a){i+=parseFloat(b[a])});var m=f(g,i);h.push({title:c.args.title,desc:c.args.text,regAddr:c.args.regAddr,pro:Math.round(g),against:Math.round(i),percent:m,sigAddr:c.args.sigAddr,deposit:d,time:e.timestamp,iHaveSignaled:k,isMine:j})}c.animateElementIn=function(a){a.removeClass("not-visible"),a.addClass("animated fadeIn")},c.animateElementOut=function(a){};var h=[];return c.newProposals=[],c.$on("connectionStateChanged",function(a,b){b&&d()}),c.minDepositChanged=function(a){void 0!==typeof a?(c.minDeposit=a,connected&&d()):c.minDeposit=0},{proposals:h,percentage:function(a){},vote:function(a,b){var d,e=ethersignalContract.at(a);for(d in web3.eth.accounts){var f=web3.eth.accounts[d];try{c.lastTx=e.setSignal(b,{from:f})}catch(a){console.log("Error submitting signal"),console.log(a),c.alerts.push({type:"danger",msg:"Error sending signal"})}c.alerts.push({type:"success",msg:"Signal sent!"})}},newProposal:function(a){var d=b.web3.eth.defaultAccount,e=positionregistry.registerPosition.getData(a.name,a.description),f=b.web3.eth.estimateGas({from:d,to:to,data:e});try{c.lastTx=positionregistry.registerPosition.sendTransaction(a.name,a.description,{from:d,to:to,gas:f})}catch(a){console.log("Error submitting position"),console.log(a),c.alerts.push({type:"danger",msg:"Error sending position"})}c.alerts.push({type:"success",msg:"Position sent!"}),$("#submitPositionModal").modal("hide"),c.newProposals=[]}}}]);